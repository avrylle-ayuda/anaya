<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Disease Prediction - ANAYA</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Nunito', sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f9f4;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .header {
      position: relative;
      background: linear-gradient(135deg, #64b651, #a5cd41);
      padding: 0;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      color: white;
      min-height: 300px;
      width: 100%;
    }

    .menu-container {
      position: absolute;
      top: 20px;
      left: 20px;
    }

    .back-button {
      font-size: 28px;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .back-button img {
      width: 24px;
      height: 24px;
      filter: brightness(0) invert(1);
    }

    .header-center {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
    }

    .header-center img {
      height: 130px;
    }

    .user-icon {
      height: 36px;
      width: 36px;
      object-fit: contain;
    }

    #title {
      position: absolute;
      bottom: -25px;
      left: 20px;
      font-size: 70px;
      font-weight: 700;
    }

    .form-section {
      padding: 40px 20px;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
    }

    .form-group {
      margin: 25px 0;
    }

    .form-group label {
      display: block;
      font-size: 20px;
      font-weight: 600;
      color: #333;
      margin-bottom: 10px;
    }

    .form-group select {
      width: 100%;
      padding: 12px;
      margin-top: 5px;
      border: 2px solid #64b651;
      border-radius: 10px;
      font-size: 16px;
      background: #f9f9f9;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2364b651' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
    }

    .form-group select:focus {
      outline: none;
      border-color: #a5cd41;
    }

    .weather-btn {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #64b651, #a5cd41);
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .weather-btn:hover {
      transform: translateY(-2px);
    }

    .weather-data {
      margin-top: 10px;
      padding: 10px;
      border: 2px solid #64b651;
      border-radius: 10px;
      background: #f9f9f9;
      font-size: 16px;
      color: #333;
    }

    .predict-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #ed1a6d, #f05f99);
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 20px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease;
      margin-top: 20px;
    }

    .predict-btn:hover {
      transform: translateY(-3px);
    }

    #todayDate {
      font-size: 30px;
      font-weight: 800;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="menu-container">
      <button class="back-button" onclick="window.location.href='home.html'">
        <img src="https://cdn-icons-png.flaticon.com/512/271/271220.png" alt="Back" style="width: 24px; height: 24px;">
      </button>
    </div>
    <div class="header-center">
      <img src="ANAYA_logo.png.png" alt="ANAYA Logo" />
    </div>
    <div style="position: absolute; top: 20px; right: 20px;">
      <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" class="user-icon" alt="User" />
    </div>
    <h2 id="title">Disease Prediction</h2>
  </div>

  <div class="form-section">
    <div class="form-group">
      <label>Today</label>
      <div id="todayDate"></div>
    </div>
    <div class="form-group">
      <label>Location in CALABARZON</label>
      <select id="provinceSelect" onchange="updateMunicipality()">
        <option value="">Select Province</option>
        <option value="Cavite">Cavite</option>
        <option value="Laguna">Laguna</option>
        <option value="Batangas">Batangas</option>
        <option value="Rizal">Rizal</option>
        <option value="Quezon">Quezon</option>
      </select>
      <select id="municipalitySelect" onchange="updateBarangay()">
        <option value="">Select Municipality</option>
      </select>
      <select id="barangaySelect" disabled>
        <option value="">Select Barangay</option>
      </select>
    </div>
    <div class="form-group">
      <label>Climate Variables</label>
      <button id="weatherBtn" class="weather-btn" onclick="confirmWeatherConnection()">Connect to Weather API</button>
      <div id="weatherData" class="weather-data" style="display: none;"></div>
    </div>
    <div class="form-group">
      <label>Prediction Range</label>
      <select id="predictionRange">
        <option value="1week">1 Week</option>
        <option value="1month">1 Month</option>
        <option value="3months">3 Months</option>
      </select>
    </div>
    <button class="predict-btn" onclick="redirectToPrediction()">Predict</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBeBzi3S6aMVhRje2oYjSidAgeAhWnQSYs",
      authDomain: "anaya-trial-25626.firebaseapp.com",
      projectId: "anaya-trial-25626",
      storageBucket: "anaya-trial-25626.firebasestorage.app",
      messagingSenderId: "318384671749",
      appId: "1:318384671749:web:3e99da15a3d3836251606c",
      measurementId: "G-QL0RDLTT87"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    function logout() {
      auth.signOut().then(() => {
        window.location.href = "signin.html";
      });
    }

    const municipalities = {
      Cavite: ["City of Bacoor", "City of Carmona", "City of Dasmariñas", "City of General Trias", "City of Imus", "City of Tagaytay", "Trece Martires City", "Alfonso", "Amadeo", "General Emilio Aguinaldo", "Indang", "Kawit", "Magallanes", "Maragondon", "Mendez", "Naic", "Noveleta", "Rosario", "Silang", "Tanza", "Ternate"],
      Laguna: ["City of Biñan", "City of Cabuyao", "City of Calamba", "City of San Pablo", "City of San Pedro", "City of Santa Rosa", "Alaminos", "Bay", "Calauan", "Cavinti", "Famy", "Kalayaan", "Liliw", "Los Baños", "Luisiana", "Lumban", "Mabitac", "Magdalena", "Majayjay", "Nagcarlan", "Paete", "Pagsanjan", "Pakil", "Pangil", "Pila", "Rizal", "Santa Cruz", "Santa Maria", "Siniloan", "Victoria"],
      Batangas: ["City of Batangas", "City of Calaca", "City of Lipa", "City of Santo Tomas", "City of Tanauan", "Agoncillo", "Alitagtag", "Balayan", "Balete", "Bauan", "Calatagan", "Cuenca", "Ibaan", "Laurel", "Lemery", "Lian", "Lobo", "Mabini", "Malvar", "Mataasnakahoy", "Nasugbu", "Padre Garcia", "Rosario", "San Jose", "San Juan", "San Luis", "San Nicolas", "San Pascual", "Santa Teresita", "Taal", "Talisay", "Taysan", "Tingloy", "Tuy"],
      Rizal: ["City of Antipolo", "Angono", "Baras", "Binangonan", "Cainta", "Cardona", "Jalajala", "Morong", "Pililla", "Rodriguez", "San Mateo", "Tanay", "Taytay", "Teresa"],
      Quezon: ["City of Tayabas", "Agdangan", "Alabat", "Atimonan", "Buenavista", "Burdeos", "Calauag", "Candelaria", "Casiguran", "Claveria", "Dolores", "General Luna", "General Nakar", "Guinayangan", "Gumaca", "Infanta", "Jomalig", "Lopez", "Lucban", "Lucena", "Macalelon", "Mauban", "Mulanay", "Padre Burgos", "Pagbilao", "Panukulan", "Patnanungan", "Perez", "Pitogo", "Plaridel", "Polillo", "Quezon", "Real", "Sampaloc", "San Andres", "San Antonio", "San Francisco", "San Narciso", "Sariaya", "Tagkawayan", "Tiaong", "Unisan"]
    };

    const barangays = {
      Cavite: {
        "City of Bacoor": ["Alima", "Aniban", "Daang Bukid", "Habay", "Mambog"],
        "City of Carmona": ["Barangay 1", "Barangay 2", "Barangay 3", "Barangay 4", "Barangay 5"],
        "City of Dasmariñas": ["Burol", "Paliparan", "Salawag", "San Agustin", "Sinclair"],
        "City of General Trias": ["Biclatan", "Gomez", "Javalera", "Navarro", "San Francisco"],
        "City of Imus": ["Alapan", "Bayan Luma", "Bucandala", "Malagasang", "Tanzang Luma"],
        "City of Tagaytay": ["Asisan", "Mabolo", "Maharlika East", "Patutong Malaki", "Sungay"],
        "Trece Martires City": ["Bucal", "Cabuco", "De Ocampo", "Inocencio", "San Agustin"],
        Alfonso: ["Amuyong", "Barangay 1", "Barangay 2", "Barangay 3", "Luksuhin"],
        Amadeo: ["Banaba", "Barangay 1", "Barangay 2", "Barangay 3", "Poblacion"],
        "General Emilio Aguinaldo": ["Batas", "Caylaway", "Dalig", "Kabulusan", "Tabora"],
        Indang: ["Alulod", "Bucal", "Harasan", "Kayquit", "Pulo"],
        Kawit: ["Binakayan", "Marulas", "Poblacion", "Santa Isabel", "Tabon"],
        Magallanes: ["Banca", "Balayungan", "Macatoc", "Poblacion", "Tua"],
        Maragondon: ["Bucal", "Pantihan", "Poblacion", "Santa Mercedes", "Talipusngo"],
        Mendez: ["Anuling", "Asis", "Banaba", "Poblacion", "San Antonio"],
        Naic: ["Bagong Kalsada", "Balsahan", "Halang", "Labac", "Munting Mapino"],
        Noveleta: ["Magdiwang", "Poblacion", "Salcedo", "San Jose", "Santa Rosa"],
        Rosario: ["Bansalangin", "Kanluran", "Ligtong", "Poblacion", "Silangan"],
        Silang: ["Barandal", "Biga", "Luzviminda", "Poblacion", "Sabutan"],
        Tanza: ["Amaya", "Bagtas", "Biga", "Calibuyo", "Poblacion"],
        Ternate: ["Bucana", "Poblacion", "San Jose", "Santa Monica", "Sapang"]
      },
      Laguna: {
        "City of Biñan": ["Bungahan", "Canlalay", "Ligid-Tipas", "Malaban", "San Antonio"],
        "City of Cabuyao": ["Banay-Banay", "Casile", "Marinig", "Poblacion I", "San Isidro"],
        "City of Calamba": ["Bucal", "Halang", "Parian", "Real", "Sucol"],
        "City of San Pablo": ["Atisan", "Concepcion", "Dolores", "San Antonio", "Santiago"],
        "City of San Pedro": ["Baliwag", "Cuyab", "Landayan", "Poblacion", "San Roque"],
        "City of Santa Rosa": ["Aplaya", "Balibago", "Caingin", "Labas", "Pooc"],
        Alaminos: ["Del Carmen", "Poblacion", "San Andres", "San Benito", "San Miguel"],
        Bay: ["Calo", "Dila", "Maitim", "Poblacion", "San Antonio"],
        Calauan: ["Balayhangin", "Lamot I", "Lamot II", "Poblacion", "San Isidro"],
        Cavinti: ["Anglas", "Caniyal", "Layugan", "Poblacion", "Tavera"],
        Famy: ["Bagong Silang", "Calumpang", "Mayatba", "Poblacion", "Tunhac"],
        Kalayaan: ["Longos", "Magsaysay", "San Antonio", "San Juan", "San Miguel"],
        Liliw: ["Bongkol", "Calumpang", "Dila", "Poblacion", "San Isidro"],
        "Los Baños": ["Bagong Silang", "Baybayin", "Lakeside", "Malinta", "Tadlac"],
        Luisiana: ["Barandal", "Calumpang", "Daniw", "Poblacion", "San Luis"],
        Lumban: ["Bambang", "Caliraya", "Maytalang I", "Poblacion", "Salac"],
        Mabitac: ["Aguilar", "Bautista", "Lambac", "Poblacion", "San Antonio"],
        Magdalena: ["Bucal", "Buenavista", "Malaking Pulo", "Poblacion", "Sta. Maria"],
        Majayjay: ["Bakya", "Burgos", "Gagalot", "Poblacion", "San Salvador"],
        Nagcarlan: ["Balayong", "Buboy", "Lansay", "Poblacion", "Sta. Lucia"],
        Paete: ["Bagong Silang", "Balawang", "Lamot", "Poblacion", "Quinale"],
        Pagsanjan: ["Barandal", "Biñan", "Cala", "Poblacion", "San Isidro"],
        Pakil: ["Banilan", "Casile", "Gomez", "Poblacion", "Rizal"],
        Pangil: ["Balite", "Nalunao", "Poblacion", "San Jose", "San Miguel"],
        Pila: ["Aplaya", "Bunyagan", "Pinagbayanan", "Poblacion", "Sta. Cruz"],
        Rizal: ["Dita", "Lumbangan", "Poblacion", "San Isidro", "Tala"],
        "Santa Cruz": ["Alipit", "Bayanin", "Poblacion", "San Juan", "Sta. Lucia"],
        "Santa Maria": ["Bagong Silang", "Cayhagan", "Poblacion", "San Isidro", "Talaga"],
        Siniloan: ["Bagong Pag-asa", "Calumpang", "Poblacion", "San Pedro", "Wawa"],
        Victoria: ["Banca-Banca", "Masapang", "Poblacion", "San Benito", "San Felix"]
      },
      Batangas: {
        "City of Batangas": ["Balagtas", "Concepcion", "Pallocan West", "San Isidro", "Talahib"],
        "City of Calaca": ["Barrio Lagnas", "Caluangan", "Lumbang Calzada", "Poblacion", "Quilo"],
        "City of Lipa": ["Balanacan", "Halang", "Mabini", "Poblacion", "Sabang"],
        "City of Santo Tomas": ["Barangay 1", "Barangay 2", "Barangay 3", "Barangay 4", "Barangay 5"],
        "City of Tanauan": ["Banadero", "Boot", "Maasín", "Malvar", "Santor"],
        Agoncillo: ["Anilao", "Balete", "Poblacion", "San Teodoro", "Subic"],
        Alitagtag: ["Bilaran", "Caloocan", "Munting Tubig", "Poblacion", "San Juan"],
        Balayan: ["Caloocan", "Dalahican", "Magabe", "Poblacion", "San Jose"],
        Balete: ["Alitagtag", "Mabini", "Poblacion", "San Juan", "Taal"],
        Bauan: ["Asis", "Coloong", "Magalang", "San Miguel", "Sinala"],
        Calatagan: ["Bagong Silang", "Balanacan", "Poblacion", "Quilitisan", "Talisay"],
        Cuenca: ["Bungkal", "Calumala", "Dona Matilde", "Poblacion", "San Felipe"],
        Ibaan: ["Bago", "Catandala", "Munting Tubig", "Poblacion", "San Agustin"],
        Laurel: ["Asis", "Bayan", "Poblacion", "San Gabriel", "Santa Cruz"],
        Lemery: ["Arumahan", "Bagong Pook", "Poblacion", "San Isidro", "Tubigan"],
        Lian: ["Balanban", "Lumaniag", "Poblacion", "San Diego", "Tara"],
        Lobo: ["Balete", "Banalo", "Poblacion", "San Miguel", "Soloc"],
        Mabini: ["Bagalangit", "Nag-Iba", "Poblacion", "San Juan", "Santo Tomas"],
        Malvar: ["Bagong Pook", "Poblacion", "San Fernando", "San Isidro", "Santa Clara"],
        Mataasnakahoy: ["Bayan", "Calumpang", "Poblacion", "San Luis", "Santa Maria"],
        Nasugbu: ["Bancalaan", "Lumbangan", "Natipuan", "Papaya", "Wawa"],
        "Padre Garcia": ["Banaba", "Calamundingan", "Poblacion", "San Antonio", "Tamloc"],
        Rosario: ["Bansal", "Lumbangan", "Poblacion", "San Isidro", "Tulo"],
        "San Jose": ["Alitagtag", "Bayan", "Poblacion", "San Pedro", "Santa Clara"],
        "San Juan": ["Baliwag", "Bayan", "Poblacion", "San Antonio", "Santa Cruz"],
        "San Luis": ["Balagtas", "Bayan", "Poblacion", "San Isidro", "Santa Teresa"],
        "San Nicolas": ["Bayan", "Calumpang", "Poblacion", "San Antonio", "Santa Maria"],
        "San Pascual": ["Bayan", "Poblacion", "San Antonio", "San Jose", "Santa Clara"],
        "Santa Teresita": ["Bayan", "Poblacion", "San Isidro", "San Jose", "Santa Maria"],
        Taal: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Santa Maria"],
        Talisay: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Santa Maria"],
        Taysan: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Santa Maria"],
        Tingloy: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Santa Maria"],
        Tuy: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Santa Maria"]
      },
      Rizal: {
        "City of Antipolo": ["Bagong Nayon", "Calawis", "Inarawan", "Mambugan", "San Isidro"],
        Angono: ["Bagumbayan", "Mahabang Parang", "Poblacion", "San Isidro", "Tawiran"],
        Baras: ["Baras Proper", "Conception", "Pinugay", "San Juan", "San Miguel"],
        Binangonan: ["Batingan", "Calumpang", "Poblacion", "San Carlos", "Tagpos"],
        Cainta: ["San Andres", "San Isidro", "San Juan", "San Roque", "Santa Rosa"],
        Cardona: ["Balibago", "Calumpang", "Poblacion", "San Roque", "Ticulio"],
        Jalajala: ["Bagumbayan", "Calumpang", "Poblacion", "San Rafael", "Sapa"],
        Morong: ["San Guillermo", "San Jose", "San Juan", "San Pedro", "San Rafael"],
        Pililla: ["Bagumbayan", "Halayhayin", "Poblacion", "Quisao", "Wawa"],
        Rodriguez: ["Balite", "Burgos", "Macabud", "Manggahan", "San Rafael"],
        "San Mateo": ["Banaba", "Gitnang Bayan", "Malay", "Santa Ana", "Silangan"],
        Tanay: ["Cuyambay", "Kaybuto", "Poblacion", "San Isidro", "Santo Niño"],
        Taytay: ["Dela Paz", "Itaas", "San Isidro", "Santa Ana", "Wawa"],
        Teresa: ["Bagong Balara", "Dulumbayan", "May-Iba", "Poblacion", "San Gabriel"]
      },
      Quezon: {
        "City of Tayabas": ["Alitao", "Bukal", "Dapdap", "Ibabang Kawayan", "Lalo"],
        Agdangan: ["Dayap", "Luzon", "Poblacion", "Salvacion", "Santo Niño"],
        Alabat: ["Alabat Proper", "Poblacion", "San Angel", "Villa Espina", "Villa Maxima"],
        Atimonan: ["Balubad", "Inalahan", "Poblacion", "San Andres", "San Isidro"],
        Buenavista: ["Bañadero", "Catulin", "Poblacion", "San Felipe", "San Isidro"],
        Burdeos: ["Amosolo", "Cabugao", "Poblacion", "San Rafael", "Tambang"],
        Calauag: ["Bagnan", "Calalahan", "Poblacion", "San Isidro", "Sumilang"],
        Candelaria: ["Bucal", "Malabanan", "Mayapa", "Poblacion", "San Andres"],
        Casiguran: ["Baler", "Calabgan", "Poblacion", "San Isidro", "Tagkawayan"],
        Claveria: ["Bagong Silang", "Poblacion", "San Isidro", "San Vicente", "Tagkawayan"],
        Dolores: ["Bagong Anyo", "Poblacion", "San Isidro", "San Jose", "Sta. Lucia"],
        "General Luna": ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        "General Nakar": ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Guinayangan: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Gumaca: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Infanta: ["Antikin", "Dinahican", "Magsaysay", "Poblacion", "Tongko"],
        Jomalig: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Lopez: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Lucban: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Lucena: ["Barangay 1", "Barangay 2", "Barangay 3", "Barangay 4", "Barangay 5"],
        Macalelon: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Mauban: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Mulanay: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        "Padre Burgos": ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Pagbilao: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Panukulan: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Patnanungan: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Perez: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Pitogo: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Plaridel: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Polillo: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Quezon: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Real: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Sampaloc: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        "San Andres": ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        "San Antonio": ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        "San Francisco": ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        "San Narciso": ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Sariaya: ["Baliwag", "Castañas", "Guisguis", "Lubigan", "Sto. Cristo"],
        Tagkawayan: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Tiaong: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"],
        Unisan: ["Bayan", "Poblacion", "San Isidro", "San Jose", "Sta. Maria"]
      }
    };

    function updateMunicipality() {
      const provinceSelect = document.getElementById("provinceSelect");
      const municipalitySelect = document.getElementById("municipalitySelect");
      const barangaySelect = document.getElementById("barangaySelect");
      const province = provinceSelect.value;

      municipalitySelect.innerHTML = '<option value="">Select Municipality</option>';
      barangaySelect.innerHTML = '<option value="">Select Barangay</option>';
      barangaySelect.disabled = true;

      if (province) {
        municipalitySelect.disabled = false;
        municipalities[province].forEach(municipality => {
          const option = document.createElement("option");
          option.value = municipality;
          option.textContent = municipality;
          municipalitySelect.appendChild(option);
        });
      } else {
        municipalitySelect.disabled = true;
      }
    }

    function updateBarangay() {
      const provinceSelect = document.getElementById("provinceSelect");
      const municipalitySelect = document.getElementById("municipalitySelect");
      const barangaySelect = document.getElementById("barangaySelect");
      const province = provinceSelect.value;
      const municipality = municipalitySelect.value;

      barangaySelect.innerHTML = '<option value="">Select Barangay</option>';
      document.getElementById("weatherData").style.display = "none";
      document.getElementById("weatherData").textContent = "";
      document.getElementById("weatherBtn").style.display = "block";

      if (province && municipality) {
        barangaySelect.disabled = false;
        barangays[province][municipality].forEach(barangay => {
          const option = document.createElement("option");
          option.value = barangay;
          option.textContent = barangay;
          barangaySelect.appendChild(option);
        });
      }
    }

    function confirmWeatherConnection() {
      const provinceSelect = document.getElementById("provinceSelect");
      const municipalitySelect = document.getElementById("municipalitySelect");
      const weatherData = document.getElementById("weatherData");

      if (provinceSelect.value && municipalitySelect.value) {
        if (confirm("Do you want to connect to the Weather API to fetch climate data?")) {
          fetchWeatherData(provinceSelect.value, municipalitySelect.value);
          document.getElementById("weatherBtn").style.display = "none";
        }
      } else {
        alert("Please select a province and municipality first.");
      }
    }

    async function fetchWeatherData(province, municipality) {
      const weatherData = document.getElementById("weatherData");
      const coords = getMunicipalityCoords(province, municipality);
      if (!coords) return;

      try {
        const response = await fetch(`https://api.openweathermap.org/data/3.0/onecall?lat=${coords.lat}&lon=${coords.lon}&appid=2e9a31d8e63514feb538670cad62a9df&units=metric`);
        const data = await response.json();

        if (data.current) {
          const temp = `Temperature: ${data.current.temp}°C`;
          const humidity = `Humidity: ${data.current.humidity}%`;
          const rainfall = `Rainfall: ${data.current.rain ? data.current.rain['1h'] || 0 : 0}mm`;
          weatherData.textContent = `${temp}, ${humidity}, ${rainfall}`;
          weatherData.style.display = "block";
        }
      } catch (error) {
        console.error("Error fetching weather data:", error);
        weatherData.textContent = "Error loading climate data";
        weatherData.style.display = "block";
      }
    }

    function getMunicipalityCoords(province, municipality) {
      const coordMap = {
        Cavite: { "City of Bacoor": { lat: 14.4587, lon: 120.9386 } },
        Laguna: { "City of Biñan": { lat: 14.3289, lon: 121.0822 } },
        Batangas: { "City of Batangas": { lat: 13.7567, lon: 121.0619 } },
        Rizal: { "City of Antipolo": { lat: 14.5858, lon: 121.1758 } },
        Quezon: { "City of Tayabas": { lat: 14.0173, lon: 121.5886 } }
      };
      return coordMap[province]?.[municipality] || null;
    }

    function redirectToPrediction() {
      const province = document.getElementById("provinceSelect").value;
      const municipality = document.getElementById("municipalitySelect").value;
      const barangay = document.getElementById("barangaySelect").value;
      const weatherDataText = document.getElementById("weatherData").textContent;
      const predictionRange = document.getElementById("predictionRange").value;

      if (!province || !municipality || !barangay) {
        alert("Please select a province, municipality, and barangay.");
        return;
      }

      const queryParams = new URLSearchParams({
        province: province,
        municipality: municipality,
        barangay: barangay,
        weather: weatherDataText || "Temperature: 25°C, Humidity: 80%, Rainfall: 5mm",
        predictionRange: predictionRange || "1week"
      }).toString();
      window.location.href = `prediction.html?${queryParams}`;
    }

    document.addEventListener("DOMContentLoaded", () => {
      if (document.getElementById("logoutButton")) {
        document.getElementById("logoutButton").addEventListener("click", logout);
      }

      const today = new Date();
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      const dateString = today.toLocaleString('en-US', options);
      document.getElementById('todayDate').textContent = dateString;
    });
  </script>
</body>
</html>